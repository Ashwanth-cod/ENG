<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ENG Playground</title>
  <style>
    :root {
      --bg: #fff;
      --fg: #000;
      --panel: #f5f5f5;
      --accent: #0077ff;
    }

    [data-theme="dark"] {
      --bg: #1e1e1e;
      --fg: #e0e0e0;
      --panel: #2a2a2a;
      --accent: #66ccff;
    }

    body {
      margin: 0;
      font-family: sans-serif;
      background: var(--bg);
      color: var(--fg);
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      background: var(--panel);
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ccc;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    .theme-toggle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--accent);
      border: none;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .theme-toggle:hover {
      transform: rotate(180deg);
    }

    main {
      display: flex;
      flex: 1;
      flex-direction: row;
      padding: 1rem;
      gap: 1rem;
    }

    textarea, pre {
      width: 100%;
      height: 100%;
      padding: 1rem;
      box-sizing: border-box;
      font-family: monospace;
      font-size: 1rem;
      border: 1px solid #ccc;
      background: var(--panel);
      color: var(--fg);
    }

    pre {
      white-space: pre-wrap;
      overflow-y: auto;
    }

    .editor-wrap {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .output-wrap {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    button {
      margin-top: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: none;
      background-color: var(--accent);
      color: white;
      cursor: pointer;
      border-radius: 4px;
    }

    .output-controls {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .icon-button {
      background-color: var(--accent);
      color: white;
      padding: 0.4rem 0.6rem;
      font-size: 1.2rem;
      border-radius: 4px;
      border: none;
      cursor: pointer;
    }

    .icon-button:hover {
      background-color: #005ecb;
    }

    @media (max-width: 768px) {
      main {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ENG Playground</h1>
    <button class="theme-toggle" title="Toggle theme">üåì</button>
  </header>

  <main>
    <div class="editor-wrap">
      <textarea id="editor">// ENG code example
say "Hello!"
let x be 5
say x * 2</textarea>
      <button onclick="runCode()">‚ñ∂ Run</button>
    </div>

    <div class="output-wrap">
      <pre id="output">// Output will appear here</pre>
      <div class="output-controls">
        <button class="icon-button" onclick="copyOutput()" title="Copy Output">üìã</button>
        <button class="icon-button" onclick="clearOutput()" title="Clear Output">üóëÔ∏è</button>
      </div>
    </div>
  </main>

  <script>
    const outputEl = document.getElementById("output");
    const editorEl = document.getElementById("editor");

    // Auto-theme based on OS
    window.addEventListener("load", () => {
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      document.documentElement.setAttribute("data-theme", prefersDark ? "dark" : "light");
    });

    // Toggle theme manually
    document.querySelector(".theme-toggle").onclick = () => {
      const current = document.documentElement.getAttribute("data-theme");
      document.documentElement.setAttribute("data-theme", current === "dark" ? "light" : "dark");
    };

    function runCode() {
      const code = editorEl.value;
      try {
        const output = runENG(code);
        outputEl.textContent = output.trim() || "// (no output)";
      } catch (e) {
        outputEl.textContent = "Error: " + e.message;
      }
    }

    function clearOutput() {
      outputEl.textContent = "// Output cleared.";
    }

    function copyOutput() {
      const text = outputEl.textContent;
      navigator.clipboard.writeText(text)
        .then(() => alert("Output copied!"))
        .catch(err => {
          console.error("Clipboard error:", err);
          prompt("Copy manually:", text);
        });
    }

    function runENG(code) {
      const lines = code
        .split("\n")
        .map(l => l.trim())
        .filter(l => l && !l.startsWith("//")); // filter out comments

      const vars = {};
      const out = [];

      for (const line of lines) {
        if (line.startsWith("say ")) {
          out.push(evalExpr(line.slice(4), vars));
        } else if (line.startsWith("let ")) {
          const [name, expr] = line.slice(4).split(" be ");
          vars[name.trim()] = evalExpr(expr, vars);
        } else {
          out.push("Unrecognized: " + line);
        }
      }

      return out.join("\n");
    }

    function evalExpr(expr, vars) {
      try {
        return Function(...Object.keys(vars), "return " + expr)(...Object.values(vars));
      } catch (e) {
        return expr;
      }
    }
  </script>
</body>
</html>
